[["applied-example.html", "7 Applied example", " 7 Applied example Please note that the data set used in this section is fairly large (~70,000 rows) and so the figures below take some time to load. This section demonstrates a typical interactive workflow with plotscaper. The goal is to showcase the package’s key features and capabilities by exploring a large, real-world data set, pertaining to a pressing issue: mental health. Mental health is a global concern. In developed nations, mental health disorders are primary contributor to years lived with disability, significantly impacting both the well-being of individuals and the economic productivity of entire countries (Organization 2022). This issue, however, extends beyond developed nations. The global burden of mental health disorders has been steadily rising over the recent decades, a trend which is particularly concerning in low-income countries where access to mental health services is even more limited (Patel et al. 2018). Having had personal experience with friends and relatives impacted by mental health issues, as well as having majored in psychology during my undergraduate studies, I have had a long-standing interest in the topic. It is clear to me that mental health is a key challenge that the world is facing today, and the first step towards solving it will require clearly identifying key trends and patterns. For this reason, I chose to dedicate this section to an exploration of a large longitudinal mental health data set. 7.0.1 About the data set The Institute of Health Information and Statistics of the Czech Republic (IHIS, ÚZIS in Czech) is a government agency established by the Czech Ministry of Health. Its primary responsibility is the collection, processing, and reporting of medical data within the country of Czechia (ÚZIS 2024). Of interest, the institute provides high-quality, open-access medical data, including information about the use and manufacture of pharmaceutics, fiscal and employment records from healthcare facilities, and various epidemiological data sets. The Long-term care data set (Soukupová et al. 2023) contains longitudinal information about long-term psychiatric care in Czechia. More specifically, it contains aggregated data on individuals released from psychiatric care facilities between 2010 and 2022. It includes information such the region of the treatment facility, the sex of the patients, age category, diagnosis based on the international ICD-10 classification (World Health Organization 2024a, 2024b), the number of hospitalizations, and the total number of days spent in care by the given subset of patients. Here’s the data set at a quick glance: df &lt;- read.csv(&quot;./data/longterm_care.csv&quot;) dplyr::glimpse(df) The data contains over 68,000 rows, totaling over 410,000 individual-patient hospitalizations. Each row records the number patients with a particular set of of characteristics released from a treatment facility during a given year, and the number of days the patients spent in treatment in total. In the original version of the data set, the column names as well as the labels of the categorical variables are in Czech. To make the analysis more easily accessible to non-Czech speakers, I took the liberty of translating most of these to English (excluding the region variable). The translation script is available in the thesis repository. Additionally, the data set website contains a JSON schema with a text description of each of the variables (Soukupová et al. 2023). I translated these descriptions as well and provide them below, in Table ??: Before we go on to explore the data set with interactive figures, there are a couple of things to note about the data set. The first is that the data has been pre-aggregated, such that each row represents the combined number of releases within a given subgroup of patients. For example, the first row indicates that, in the year 2019, 13 women aged 40-49 were released from treatment facilities in Olomoucký kraj (region), after receiving short-term care for F10 ICD-10 diagnosis (mental and behavioural disorders due to alcohol use, World Health Organization 2024a) for a sum total of 196 days: df[1, ] The reason for this aggregation is likely to anonymize the data and reduce the risk of identifying individual patients (see e.g. Pina et al. 2024). However, when creating visualizations, we need to take the fact that each row represents a group of patients into account. For instance, when drawing a barplot, simply plotting row counts would not be appropriate, since that would ignore the size of the patient groups. Instead, to represent the data properly, we should aggregate (sum) either cases or days, depending on the question of interest. The same applies to all other aggregation plots, such as histograms (i.e. weighted histograms, see e.g. Unwin, Theus, and Härdle 2008) and fluctuation diagrams. Fortunately, as we will see, plotscaper makes it easy to create these weighted types visualizations. And further, while the information this aggregated data provides inherently less granular information than patient-level records, we will see that it still preserves a large amount of structure. 7.0.2 Interactive exploration 7.0.2.1 The relationship between cases and days We start by exploring the relationship between the two primary continuous variables of interest: cases (the number of patients in a given subgroup released from care) and days (the total number of days the given subgroup of patients spent in care). Intuitively, we would expect a positive, linear relationship between these variables, such that a larger patient groups should spend more days in care. We can use plotscaper to visualize this relationship via a scatterplot: library(plotscaper) # Load in the package df |&gt; create_schema() |&gt; # Create a declarative schema for the figure add_scatterplot(c(&quot;cases&quot;, &quot;days&quot;)) |&gt; # Add a scatterplot render() # Render the schema into an interactive figure Interestingly, the pattern that the points show is not a simple linear trend. Instead, the points seem to cluster in three distinct “leaflets”, each exhibiting a roughly linear trend. This suggests the presence of a pooling effect, such that the overall trend is the result of combining three distinct groups. Closer inspection of the data reveals that the stay_category variable has three levels: short-term (&lt; 3 months), medium-term (3-6 months), and long-term (6+ months) care. Color-coding the cases indeed confirms that the three levels of stay_category correspond to the leaflets: df |&gt; create_schema() |&gt; add_scatterplot(c(&quot;cases&quot;, &quot;days&quot;)) |&gt; add_barplot(c(&quot;stay_category&quot;, &quot;cases&quot;)) |&gt; # y-axis is weighted by cases assign_cases(which(df$stay_category == &quot;short-term&quot;), 1) |&gt; # Mark short-term green assign_cases(which(df$stay_category == &quot;long-term&quot;), 2) |&gt; # Mark long-term red render() Try clicking on the bars in the barplot to confirm there is a fairly minimal overlap between the data points in the three categories. To remove all selection, double-click the figure. However, the pooling effect does not itself explain the absence of points between the three leaflets. If the distribution of cases and days within each of the three stay_category levels were uniform, we should expect to see more points within the gaps between the leaflets. This additionally suggests a potential selection process, where patients are less likely to be discharged at durations near the category boundaries. We can confirm this by plotting the average number of days a group of patients spent in care: # Compute the average number of days spent in treatment df$avg_days &lt;- df$days / df$cases df |&gt; create_schema() |&gt; add_scatterplot(c(&quot;cases&quot;, &quot;avg_days&quot;)) |&gt; add_barplot(c(&quot;stay_category&quot;, &quot;cases&quot;)) |&gt; assign_cases(which(df$stay_category == &quot;short-term&quot;), 1) |&gt; assign_cases(which(df$stay_category == &quot;long-term&quot;), 2) |&gt; set_scale(&quot;scatterplot1&quot;, &quot;y&quot;, # Log-transform the scatterplot&#39;s y-axis transformation = &quot;log10&quot;, default = TRUE) |&gt; render() Now we can clearly see the gaps between the three different distributions along the y-axis. Try querying the points near the gaps by pressing the Q key and hovering over them. You should observe that the gaps roughly span the 60-90 day and 150-210 day ranges, corresponding to 2-3 months and 5-7 months, respectively. The trend we see in the scatterplot above strong indication of a selection process is at work. Specifically, it seems that patients who stay in treatment for more than two months are likely to be transferred to medium-term care and kept around for longer, and, likewise, those who stay in treatment for more than five months are likely to be moved to long-term care. There are likely administrative of health-insurance related reasons for this trend, nevertheless, it is still an interesting pattern to take note of. 7.0.2.2 Number of cases over time A key question is how have the numbers of patients in treatment evolved over time. We can investigate this by plotting the same scatterplot as we did in the section above, as well as two barplots showing the total number of cases and the total number days in treatment, within each year. We can also include a histogram of the number of days, for a good measure: schema &lt;- df |&gt; create_schema() |&gt; add_scatterplot(c(&quot;cases&quot;, &quot;days&quot;)) |&gt; add_barplot(c(&quot;year&quot;, &quot;cases&quot;)) |&gt; add_barplot(c(&quot;year&quot;, &quot;days&quot;)) |&gt; add_histogram(c(&quot;days&quot;, &quot;days&quot;)) |&gt; # Again, make sure to weigh the y-axis set_parameters(&quot;histogram1&quot;, width = 20) # Set histogram binwidth to 20 days schema |&gt; render() From the barplots, we can immediately see an interesting pattern: while the numbers of cases seem to have declined over time, the number of days patients spend in care seem to seems to have stayed fairly constant. This suggest that while fewer patients are being hospitalized, they are spending longer time in care. We can indeed confirm this interactively. Try clicking on the bars corresponding to the year 2010 and 2022, in either of the two barplots (feel free to mark either of the bars by holding down the 1 or 2 keys and clicking them). It is clearly visible that, compared to 2010, in 2022 there were more patients in long term care, and the relationship between the number of cases and the number of days in care was steeper. While, on its own, the declining number of cases over time might appear as a positive development, the constant number days in treatment suggests a more worrying trend. Specifically, treatment facility placements are limited resource (Organization 2022), and the fact that days in treatment have stayed constant while cases have declined may indicate that the healthcare system is becoming burdened by long-term care patients, reducing its capacity to serve new patients. We can also scrutinize the trend more closely by zooming into the histogram: schema |&gt; assign_cases(which(df$year == 2010), 1) |&gt; assign_cases(which(df$year == 2022), 2) |&gt; zoom(&quot;histogram1&quot;, c(-100, 0, 3e03, 1e05), units = &quot;data&quot;) |&gt; render() You can also zoom into a plot interactively by clicking and dragging to select a rectangular region in the plot and pressing the Z key. You can chain multiple zooms to magnify small areas. If you want to undo zooming, press either the X key to undo the revert one level of zoom, or R to reset the figure to its default state (including zoom level). By clicking on the two bars, you should be able to see that, compared with 2010, the distribution of days spent in treatment in 2022 had a fatter tail, suggesting that patients spent longer periods of time in care. 7.0.2.3 Age and child and adolescent mental health Child and adolescent mental health is a particularly important aspect of the global mental health decline. Childhood mental health disorders are particularly concerning since they can happen during critical developmental periods, leading to life-long consequences (see e.g. Keeley 2021). Furthermore, compared to adults, children have less agency in addressing mental health challenges, relying heavily on primary caregivers and schools. Fortunately, the overall proportion of children and adolescents in the data set was fairly low, amounting to &lt;9% of all cases and &lt;6% of the total number of days spent in treatment: aggregate(cbind(cases, days) ~ care_category, sum, data = df) |&gt; lapply(function(x) { if (is.numeric(x)) return(x / sum(x)) else x }) |&gt; data.frame() However, we may be interested in investigating how these patient counts have evolved over time. To do this, we can make use of the following figure: # Create a figure layout with two small plots in the left # column, and one tall plot in the right column layout &lt;- matrix(c( 1, 3, 2, 3 ), nrow = 2, byrow = TRUE) df |&gt; create_schema() |&gt; add_barplot(c(&quot;year&quot;, &quot;cases&quot;)) |&gt; add_barplot(c(&quot;year&quot;, &quot;days&quot;)) |&gt; add_barplot(c(&quot;care_category&quot;, &quot;cases&quot;)) |&gt; set_layout(layout) |&gt; # Set the layout render() To explore how the proportion of child and adolescent patients has evolved over time, we will need to use a slightly more complex interactive workflow than we have used so far. Try taking the following steps: Mark the cases corresponding to children and adolescents by clicking on the corresponding bar in the right barplot, while holding down the 1 key Normalize the two leftmost barplots, corresponding to the number of cases and the total number of days in treatment by year, by clicking on the plots and pressing the N key (you can reverse back to absolute counts by pressing the N key again) Zoom into the regions of the two barplots containing the green cases by clicking-and-dragging to select a rectangular region and pressing the Z key. By following these steps, you should end up with a figure similar to the one below: df |&gt; create_schema() |&gt; add_barplot(c(&quot;year&quot;, &quot;cases&quot;)) |&gt; add_barplot(c(&quot;year&quot;, &quot;days&quot;)) |&gt; add_barplot(c(&quot;care_category&quot;, &quot;cases&quot;)) |&gt; assign_cases(which(df$care_category == &quot;child&quot;)) |&gt; normalize(&quot;barplot1&quot;) |&gt; normalize(&quot;barplot2&quot;) |&gt; zoom(&quot;barplot1&quot;, c(0, 0, 1, 0.15)) |&gt; zoom(&quot;barplot2&quot;, c(0, 0, 1, 0.15)) |&gt; set_layout(layout) |&gt; render() Interestingly, the two barplots show the opposite trend. While the proportion of the treatment days used by children and adolescents has declined over time, the proportion of total cases they make up has increased. The relative increase in cases appears to be driven by an overall decline in patient numbers: in absolute counts, the number of child and adolescent patients has remained fairly constant between 2010 to 2022, while the total patient count has decreased. We can also get a more granular breakdown by plotting the age category variable: df |&gt; create_schema() |&gt; add_barplot(c(&quot;age_category&quot;, &quot;cases&quot;)) |&gt; add_barplot(c(&quot;year&quot;, &quot;cases&quot;)) |&gt; add_barplot(c(&quot;age_category&quot;, &quot;days&quot;)) |&gt; add_barplot(c(&quot;year&quot;, &quot;days&quot;)) |&gt; render() Again, if we interrogate the figure by employing interactive actions such as selection, zooming, and normalization, we can discover that one age category in which there has been steady growth in both the proportion of cases and days spend in treatment are 70-79 year olds. This aligns with the limited placement availability hypothesis: while these patients account for a relatively small fraction of the total cases, they represent a disproportionately large and increasing proportion of days in treatment. Later, we will also see evidence that many of these patients suffer from neurodegenerative diseases, which require intensive long-term care. It may be the case that, with increasing life-expectancy, the healthcare system is not able to handle the influx of older patients, limiting the availability of placements. 7.0.2.4 Prevalence of mental disorders Another important information we can glean from the data set is the prevalence of different mental disorders. The data set identifies the disorders according to ICD-10, an internationally recognized disease classification system published by the World Health organization which organizes various diseases into categories based on aetiology (World Health Organization 2024a). In the data set, the vast majority diagnoses come from the F category, which represents mental and behavioral disorders, although there are also few references to the G category, which represents diseases of the nervous system. Also note that while some levels of the diagnosis variable represent a singular ICD-10 diagnosis (e.g. f10, f2), other represent a range of diagnoses (e.g. f11-f19), a union (e.g. f0 and g30), or an exclusive difference (e.g. f4 without f42). We can visualize the distribution of the various disorders via the following barplot: # Create ordering for the bars based on frequency of cases order_df &lt;- aggregate(cases ~ diagnosis, sum, data = df) order_df &lt;- order_df[order(order_df$cases), ] df |&gt; create_schema() |&gt; add_barplot(c(&quot;diagnosis&quot;, &quot;cases&quot;)) |&gt; set_scale(&quot;barplot1&quot;, &quot;x&quot;, breaks = order_df$diagnosis) |&gt; render() You can also sort the barplot bars interactively by pressing the O key. We can immediately see that the majority patient load is taken up by the top 5 disorders with &gt; 40,000 cumulative cases each. Press the Q key and hover over each of the top 5 bars to see what disorders they represent. I took the liberty of transcribing the names/classification of the disorders from the ICD-10 website (World Health Organization 2024a). Each row of Table [REFERENCE] contains the classification code used in the data, along with the name of the diagnosis/es according to ICD-10. I’ve also added some notes in the parentheses: Table 7.1: ICD-10 mental disorder codes Code Description f10 Mental and behavioural disorders due to use of alcohol f2 Dementia in other diseases classified elsewhere (includes Parkinson’s, Huntington’s, and Creutzfeld-Jacobs disease) f0 and g30 Dementia in Alzheimer disease (f0), Alzheimer disease (g30) f4 without f42 Organic amnesic syndrome, not induced by alcohol and other psychoactive substances (f4) without obsessive-compulsive disorder (f42) f11-f19 Mental and behavioural disorders due to psychoactive substance use (excluding alcohol, f10) f8–f9 Unspecified organic or symptomatic mental disorder f32–f33 Depressive episode (f32), Recurrent depressive disorder (f33) f60–f61 Specific personality disorders (f60; includes e.g. paranoid, schizoid, histrionic, or anxious/avoidant personality disorders), mixed and other personality disorders (f61) f7 Personality and behavioural disorders due to brain disease, damage and dysfunction f3 without f32&amp;f33 Unspecified dementia (f3) without depression (f32 and f33) f62–f69 Personality and behavioral disorders (includes things such as PTSD, habit and impulse disorders, sexual preference disorders, etc…) f5 Delirium, not induced by alcohol and other psychoactive substances other f42 Obsessive-compulsive disorder Thus, the most mental disorders were those caused by the use of alcohol, followed by dementias caused by Alzheimer’s and other diseases, followed by amnesia (not caused psychoactive substances), and, finally, disorders caused by non-alcohol psychoactive substances. The amnesia diagnosis is quite interesting, becuase it explicitly rules out obsessive-compulsive disorder (OCD; f42). While the connection between OCD and amnesia might not be immediately clear (at least to a layman such as myself), there is evidence that people with OCD tend to obsess over not remembering certain events and have less confidence in recollecting things from the past (see e.g. Muller and Roberts 2005). For instance, a person with OCD may have anxiety over whether or not they locked the doors to their house or turned off the stove. Thus it makes sense to explicitly rule out this diagnosis. df |&gt; create_schema() |&gt; add_barplot(c(&quot;diagnosis&quot;, &quot;cases&quot;)) |&gt; add_barplot(c(&quot;age_category&quot;, &quot;cases&quot;)) |&gt; set_scale(&quot;barplot1&quot;, &quot;x&quot;, breaks = order_df$diagnosis) |&gt; render() References Keeley, Brian. 2021. “The State of the World’s Children 2021: On My Mind–Promoting, Protecting and Caring for Children’s Mental Health.” UNICEF. Muller, Jeffrey, and John E Roberts. 2005. “Memory and Attention in Obsessive–Compulsive Disorder: A Review.” Journal of Anxiety Disorders 19 (1): 1–28. Organization, World Health. 2022. World Mental Health Report: Transforming Mental Health for All. World Health Organization. Patel, Vikram, Shekhar Saxena, Crick Lund, Graham Thornicroft, Florence Baingana, Paul Bolton, Dan Chisholm, et al. 2018. “The Lancet Commission on Global Mental Health and Sustainable Development.” The Lancet 392 (10157): 1553–98. Pina, Eduardo, José Ramos, Henrique Jorge, Paulo Váz, José Silva, Cristina Wanzeller, Maryam Abbasi, and Pedro Martins. 2024. “Data Privacy and Ethical Considerations in Database Management.” Journal of Cybersecurity and Privacy 4 (3): 494–517. Soukupová, J, H Melicharová, O Šanca, V Bartůněk, J Jarkovský, and M Komenda. 2023. “Dlouhodobá psychiatrická péče.” NZIP. https://www.nzip.cz/data/2060-dlouhodoba-psychiatricka-pece. Unwin, Antony, Martin Theus, and Wolfgang Härdle. 2008. “Exploratory Graphics of a Financial Dataset.” In Handbook of Data Visualization, 832–52. Springer Science &amp; Business Media. ÚZIS. 2024. “About us - ÚZIS ČR.” https://www.uzis.cz/index-en.php?pg=about-us. World Health Organization. 2024a. “ICD-10 Version:2019.” https://icd.who.int/browse10/2019/en. ———. 2024b. “International Classification of Diseases (ICD).” https://www.who.int/standards/classifications/classification-of-diseases. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
