<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Design | Fluent Graphics</title>
  <meta name="description" content="3 Design | Fluent Graphics" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Design | Fluent Graphics" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Design | Fluent Graphics" />
  
  
  

<meta name="author" content="Adam Bartonicek" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.1.3/tabwid.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Abstract</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#defining-interactivity"><i class="fa fa-check"></i><b>2.1</b> Defining Interactivity</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#mathematical-theory"><i class="fa fa-check"></i><b>2.2</b> Mathematical Theory</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introduction.html"><a href="introduction.html#relations"><i class="fa fa-check"></i><b>2.2.1</b> Relations</a></li>
<li class="chapter" data-level="2.2.2" data-path="introduction.html"><a href="introduction.html#functions"><i class="fa fa-check"></i><b>2.2.2</b> Functions</a></li>
<li class="chapter" data-level="2.2.3" data-path="introduction.html"><a href="introduction.html#partitions"><i class="fa fa-check"></i><b>2.2.3</b> Partitions</a></li>
<li class="chapter" data-level="2.2.4" data-path="introduction.html"><a href="introduction.html#preorders"><i class="fa fa-check"></i><b>2.2.4</b> Preorders</a></li>
<li class="chapter" data-level="2.2.5" data-path="introduction.html"><a href="introduction.html#monoids"><i class="fa fa-check"></i><b>2.2.5</b> Monoids</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#components-of-a-data-visualization-system"><i class="fa fa-check"></i><b>2.3</b> Components of a Data Visualization System</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introduction.html"><a href="introduction.html#scales"><i class="fa fa-check"></i><b>2.3.1</b> Scales</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="design.html"><a href="design.html"><i class="fa fa-check"></i><b>3</b> Design</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="design.html"><a href="design.html#factors"><i class="fa fa-check"></i><b>3.0.1</b> Factors</a></li>
<li class="chapter" data-level="3.0.2" data-path="design.html"><a href="design.html#reducers"><i class="fa fa-check"></i><b>3.0.2</b> Reducers</a></li>
<li class="chapter" data-level="3.0.3" data-path="design.html"><a href="design.html#scales-1"><i class="fa fa-check"></i><b>3.0.3</b> Scales</a></li>
<li class="chapter" data-level="3.0.4" data-path="design.html"><a href="design.html#expanses"><i class="fa fa-check"></i><b>3.0.4</b> Expanses</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>4</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fluent Graphics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="design" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Design<a href="design.html#design" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="factors" class="section level3 hasAnchor" number="3.0.1">
<h3><span class="header-section-number">3.0.1</span> Factors<a href="design.html#factors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Factors provide a way to partition the data into multiple disjoint parts.</p>
<div id="product-factors" class="section level4 hasAnchor" number="3.0.1.1">
<h4><span class="header-section-number">3.0.1.1</span> Product factors<a href="design.html#product-factors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can combine a factor with <span class="math inline">\(j\)</span> levels and another factor with <span class="math inline">\(k\)</span> levels into a product factor with up to <span class="math inline">\(j \cdot k\)</span> levels.</p>
<p>I independently discovered a formula similar to <span class="citation">(<a href="#ref-wickham2013">Wickham 2013</a>)</span>:</p>
<p><span class="math display">\[i_{\text{product}} = i_1 + i_2 \cdot \max(j, k)\]</span></p>
</div>
</div>
<div id="reducers" class="section level3 hasAnchor" number="3.0.2">
<h3><span class="header-section-number">3.0.2</span> Reducers<a href="design.html#reducers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="citation">(<a href="#ref-gray1997">Gray et al. 1997</a>)</span> came up with OLAP data cube</p>
</div>
<div id="scales-1" class="section level3 hasAnchor" number="3.0.3">
<h3><span class="header-section-number">3.0.3</span> Scales<a href="design.html#scales-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Most data visualization packages rely on some concept of scales. While there is some overlap with scales discussed in <a href="introduction.html#introduction">INTRODUCTION</a>, here I mean scales as objects (in a broad sense: they may be functions, classes, etc…) which are used to translate values from the data space (<em>domain</em>) to the graphical space (<em>codomain</em>).</p>
<p>Many packages implement scales with domain and codomain as two components, however these often tend to have distinct interfaces. For example, the <strong>D3</strong> library <span class="citation">(<a href="#ref-bostock2011">Bostock, Ogievetsky, and Heer 2011</a>)</span> takes a data-centric approach, with <code>domain</code> and <code>range</code> (= codomain) implemented as tuples or arrays of values, and during the translation step each is called via a different specialized function (e.g. <code>normalize()</code> and <code>scale()</code> functions for continuous and discrete/ordinal domains and various <code>interpolate()</code> functions for codomains). Similarly, in the <strong>scales</strong> package <span class="citation">(<a href="#ref-R-scales"><strong>R-scales?</strong></a>)</span>, the scaling operation relies on a <code>limits</code> vector (2-element numeric vector for continuous scales and an arbitrary-length character vector/factor for discrete), a <code>palette()</code> function (corresponding to the codomain), and <code>map_discrete()</code> or <code>map_continuous()</code> function (which further relies on a <code>rescale()</code> method).</p>
<p>In <code>plotscaper</code>, scales also consist of two components, however, both components share the same interface. Specifically, each scale consists of a <code>domain</code> and <code>codomain</code> which both implement the interface <code>Expanse&lt;T&gt;</code>. <code>Expanse&lt;T&gt;</code> is generic and hence <code>Scale&lt;T, U&gt;</code> has two type arguments: the type of its domain and the type of its codomain. The way scale can be used then is that it can be used to <em>push values forward</em> through its domain first and codomain second, or <em>pull them back</em>, through its codomain first and domain second. Hence, the basic interface for a scale is:</p>
<pre><code>interface Scale&lt;T, U&gt; {
  domain: Expanse&lt;T&gt;
  codomain: Expanse&lt;U&gt;
  
  pushforward(value: T): U
  pullback(value: U): T
}
</code></pre>
</div>
<div id="expanses" class="section level3 hasAnchor" number="3.0.4">
<h3><span class="header-section-number">3.0.4</span> Expanses<a href="design.html#expanses" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Expanses provide a way to translate between data values and relative proportions of graphical encodings, such as the x- and y-axis position, area, or size. Formally speaking, an expanse is a set of some possible data values <span class="math inline">\(D\)</span>, together with a pair of maps:</p>
<ul>
<li>A <em>normalize</em> map <span class="math inline">\(n: D \to \mathbb{R}\)</span></li>
<li>An <em>unnormalize</em> map <span class="math inline">\(u: \mathbb{R} \to D\)</span></li>
</ul>
<p>This may seem rather abstract, however, what might make things clearer is that most of the time we will be dealing with specific subsets of <span class="math inline">\(D\)</span> and <span class="math inline">\(\mathbb{R}\)</span>: observed data <span class="math inline">\(D^* \subseteq D\)</span> and percentages <span class="math inline">\(p^* \in [0, 1] \subset \mathbb{R}\)</span>. Then, provided that the expanse has been trained on the observed data values and no adjustments such as expanding margins, zooming, or panning have been made:</p>
<ul>
<li>The normalize map translates observed data to percentages: <span class="math inline">\(n(d^*) \to [0, 1]\)</span></li>
<li>The unnormalize map translates percentages to observed data: <span class="math inline">\(u(p^*) \to D^*\)</span></li>
</ul>
<div id="zero-and-one" class="section level4 hasAnchor" number="3.0.4.1">
<h4><span class="header-section-number">3.0.4.1</span> Zero and One<a href="design.html#zero-and-one" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The maps may also take in and return values outside of <span class="math inline">\(D^*\)</span> and <span class="math inline">\([0, 1]\)</span>, if adjustments have been made. For instance, in most data visualization packages, x- and y-axis limits are by default expanded some percentage beyond the range of the observed data to avoid the maximum and minimum datapoints from overlapping with the limits. For example, in base R:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="design.html#cb2-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb2-2"><a href="design.html#cb2-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb2-3"><a href="design.html#cb2-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">5</span>)</span>
<span id="cb2-4"><a href="design.html#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="design.html#cb2-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb2-6"><a href="design.html#cb2-6" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>) </span>
<span id="cb2-7"><a href="design.html#cb2-7" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xaxs =</span> <span class="st">&#39;i&#39;</span>, <span class="at">yaxs =</span> <span class="st">&#39;i&#39;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-3"></span>
<img src="_main_files/figure-html/unnamed-chunk-3-1.png" alt="Expanding axes. By default, axes in base R `plot()` function are expanded 4% beyond the range of the data (left). Otherwise, datapoints on the limits of their respective scales end up overlapping with the plot borders (right)." width="672" />
<p class="caption">
Figure 3.1: Expanding axes. By default, axes in base R <code>plot()</code> function are expanded 4% beyond the range of the data (left). Otherwise, datapoints on the limits of their respective scales end up overlapping with the plot borders (right).
</p>
</div>
<p>Thus, upon normalizing the minimum and maximum data values, the expanse should return values other than <span class="math inline">\(\{0, 1\}\)</span>. Likewise, to support user interactions such as zooming and panning, the expanses may accept and return values outside of <span class="math inline">\(D^*\)</span> and <span class="math inline">\([0, 1]\)</span>.</p>
<p>Zooming and panning should be orthogonal to the underlying data type, such that user can interact with the plots the same way<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, no matter whether their axes are continuous, discrete, or some combination of the two. To this end, I introduce two parameters representing the normalized value (<span class="math inline">\(p\)</span>) of the minimum and maximum data point, called <em>zero</em> and <em>one</em> respectively. These parameters are agnostic to the underlying data type, such that if we have the data type-specific maps <span class="math inline">\(n&#39;\)</span> and <span class="math inline">\(u&#39;\)</span>, the complete normalize and unnormalize maps are:</p>
<p><span class="math display">\[n(d) = \text{zero} + n&#39;(d) \cdot (\text{one} - \text{zero})\]</span>
<span class="math display">\[u(p) = u&#39; \bigg(\frac{p - \text{zero}}{\text{one} - \text{zero}} \bigg)\]</span></p>
<p>To simplify, here’s what effect setting the two parameters to specific values has:</p>
<table>
<colgroup>
<col width="6%" />
<col width="5%" />
<col width="88%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">Zero</th>
<th align="right">One</th>
<th align="left">Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.95</td>
<td align="left">Expands the margins by ~5% (actually 5.555…% since 0.05 / 0.9 = 0.0555…)</td>
</tr>
<tr class="even">
<td align="right">0.05</td>
<td align="right">1.05</td>
<td align="left">Shifts the expanse ‘up’ by 5% (e.g. moves x-axis 5% right)</td>
</tr>
<tr class="odd">
<td align="right">-0.50</td>
<td align="right">1.50</td>
<td align="left">Zooms into the middle 50% of the expanse (25 percentile goes to 0 and 75th to one)</td>
</tr>
</tbody>
</table>
</div>
<div id="expanse-interface" class="section level4 hasAnchor" number="3.0.4.2">
<h4><span class="header-section-number">3.0.4.2</span> Expanse Interface<a href="design.html#expanse-interface" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are also other behaviours that expanses should support. For instance, we may want to be able to reset the expanse to defaults, retrain when the underlying data changes, and return nicely formatted breaks. How these behaviours are implemented, as well as other types of behavior, may be specific to the underlying data type. Overall, expanse interface may look something like this:</p>
<pre><code>interface Expanse&lt;T&gt; {
  normalize(value: T): number
  unnormalize(value: number): T
  defaultize(): this
  
  setZero(zero: number, default: boolean): this
  setOne(one: number, default: boolean): this
  freezeZero(): this
  freezeOne(): this
  
  move(amount: number): this
  expand(zero: number, one: number): this
  
  retrain(values: T[]): this
  breaks(n?: number): T[]  
}</code></pre>
</div>
<div id="continuous-expanses" class="section level4 hasAnchor" number="3.0.4.3">
<h4><span class="header-section-number">3.0.4.3</span> Continuous Expanses<a href="design.html#continuous-expanses" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The continuous expanse has as its underlying set <span class="math inline">\([\min, \max] \subseteq \mathbb{R}\)</span>. To understand how it works, let’s build it step by step.</p>
<p>We start with the basic normalizing function:</p>
<ol style="list-style-type: decimal">
<li><span class="math display">\[n(d) = \frac{d - \min}{\max - \min}\]</span></li>
</ol>
<p>This function takes some data value <span class="math inline">\(d \in [\min, \max]\)</span> and transforms it to <span class="math inline">\([0, 1]\)</span>. Most data visualization systems use a function like this at some step of the scaling processs - see <a href="https://github.com/r-lib/scales/blob/84560bf54e02315477a05384ee67991e9e8fc52c/R/bounds.R#L85"><code>scales::rescale</code></a> and <strong>D3</strong> <a href="https://github.com/d3/d3-scale/blob/d6904a4bde09e16005e0ad8ca3e25b10ce54fa0d/src/continuous.js#L122"><code>normalize</code></a>.</p>
<p>This may work well for typical linear scales. However, we may also want to apply some transformation <span class="math inline">\(f\)</span>, such as square root or log. Then, to ensure that the observed data values still get normalized to <span class="math inline">\([0, 1]\)</span>, we need to apply the transformation to both <span class="math inline">\(d\)</span> and the limits:</p>
<ol start="2" style="list-style-type: decimal">
<li><span class="math display">\[\frac{f(d) - f(\min)}{f(\max) - f(\min)}\]</span></li>
</ol>
<p>Finally, as was discussed in <a href="design.html#expanses">EXPANSES</a>, we want to be able to incorporate the zero and one paramaters, leading to the final normalizing function:</p>
<p><span class="math display">\[n(d) = \text{zero} + \frac{f(d) - f(\min)}{f(\max) - f(\min)} \cdot (\text{zero} - \text{one})\]</span></p>
<p>To obtain the unnormalizing function, we can simply invert the normalizing function:</p>
<p><span class="math display">\[u(p) = f^{-1} \bigg\{ f(\min) + \frac{p - \text{zero}}{\text{one} - \text{zero}} \cdot \big[ f(\max) - f(\min) \big] \bigg\}\]</span></p>
<p>The function transforms <span class="math inline">\(x\)</span> to a percentage value <span class="math inline">\(p \in [0, 1]\)</span>, provided <span class="math inline">\(x\)</span> is within <span class="math inline">\([\min, \max]\)</span>. The value <span class="math inline">\((\max - \min)\)</span> is also sometimes called the <em>range</em> (not to be confused with <strong>D3</strong> <code>range</code>).</p>
<p>We can invert the normalizing function and obtain the unnormalizing function, which is, for some percentage <span class="math inline">\(p \in [0, 1]\)</span>:</p>
<p><span class="math display">\[u(p) = \min + p \cdot (\max - \min)\]</span>
returns a value within the <span class="math inline">\([\min, \max]\)</span> range, corresponding to the proportion of the maximum possible distance (range) from the origin (<span class="math inline">\(\min\)</span>). For example, <span class="math inline">\(u(0.5)\)</span>, returns a value that is located halfway between the limits.</p>
<p>We can implement a simple continuous expanse like so:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb4-1"><a href="design.html#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="design.html#cb4-2" tabindex="-1"></a><span class="kw">function</span> <span class="fu">identity</span><span class="op">&lt;</span>T<span class="op">&gt;</span>(x<span class="op">:</span> T) {</span>
<span id="cb4-3"><a href="design.html#cb4-3" tabindex="-1"></a>  <span class="cf">return</span> x<span class="op">;</span></span>
<span id="cb4-4"><a href="design.html#cb4-4" tabindex="-1"></a>}</span>
<span id="cb4-5"><a href="design.html#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="design.html#cb4-6" tabindex="-1"></a><span class="kw">function</span> <span class="fu">expanseContinuous</span>(min <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> max <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb4-7"><a href="design.html#cb4-7" tabindex="-1"></a>  <span class="kw">const</span> [zero<span class="op">,</span> one] <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]</span>
<span id="cb4-8"><a href="design.html#cb4-8" tabindex="-1"></a>  <span class="kw">const</span> [trans<span class="op">,</span> inv] <span class="op">=</span> [identity<span class="op">,</span> identity]</span>
<span id="cb4-9"><a href="design.html#cb4-9" tabindex="-1"></a>  </span>
<span id="cb4-10"><a href="design.html#cb4-10" tabindex="-1"></a>  <span class="cf">return</span> { min<span class="op">,</span> max<span class="op">,</span> zero<span class="op">,</span> one<span class="op">,</span> trans<span class="op">,</span> inv<span class="op">,</span></span>
<span id="cb4-11"><a href="design.html#cb4-11" tabindex="-1"></a>    <span class="fu">range</span>() {</span>
<span id="cb4-12"><a href="design.html#cb4-12" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">max</span> <span class="op">-</span> <span class="kw">this</span><span class="op">.</span><span class="at">min</span><span class="op">;</span></span>
<span id="cb4-13"><a href="design.html#cb4-13" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-14"><a href="design.html#cb4-14" tabindex="-1"></a>    <span class="fu">transRange</span>() {</span>
<span id="cb4-15"><a href="design.html#cb4-15" tabindex="-1"></a>      <span class="kw">const</span> { min<span class="op">,</span> max<span class="op">,</span> trans } <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb4-16"><a href="design.html#cb4-16" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">trans</span>(max) <span class="op">-</span> <span class="fu">trans</span>(min)<span class="op">;</span></span>
<span id="cb4-17"><a href="design.html#cb4-17" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-18"><a href="design.html#cb4-18" tabindex="-1"></a>    <span class="fu">normalize</span>(x<span class="op">:</span> <span class="dt">number</span>) {</span>
<span id="cb4-19"><a href="design.html#cb4-19" tabindex="-1"></a>      <span class="kw">const</span> { min<span class="op">,</span> zero<span class="op">,</span> one<span class="op">,</span> trans } <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb4-20"><a href="design.html#cb4-20" tabindex="-1"></a>      <span class="kw">const</span> normalized <span class="op">=</span> (<span class="fu">trans</span>(x) <span class="op">-</span> <span class="fu">trans</span>(min)) <span class="op">/</span> <span class="kw">this</span><span class="op">.</span><span class="fu">transRange</span>()<span class="op">;</span></span>
<span id="cb4-21"><a href="design.html#cb4-21" tabindex="-1"></a>      <span class="cf">return</span> zero <span class="op">+</span> normalized <span class="op">*</span> (one <span class="op">-</span> zero)<span class="op">;</span></span>
<span id="cb4-22"><a href="design.html#cb4-22" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-23"><a href="design.html#cb4-23" tabindex="-1"></a>    <span class="fu">unnormalize</span>(p<span class="op">:</span> <span class="dt">number</span>) {</span>
<span id="cb4-24"><a href="design.html#cb4-24" tabindex="-1"></a>      <span class="kw">const</span> { min<span class="op">,</span> zero<span class="op">,</span> one<span class="op">,</span> trans<span class="op">,</span> inv } <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb4-25"><a href="design.html#cb4-25" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">inv</span>(<span class="fu">trans</span>(min) <span class="op">+</span> ((p <span class="op">-</span> zero) <span class="op">/</span> (one <span class="op">-</span> zero)) <span class="op">*</span> <span class="kw">this</span><span class="op">.</span><span class="fu">transRange</span>())<span class="op">;</span></span>
<span id="cb4-26"><a href="design.html#cb4-26" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb4-27"><a href="design.html#cb4-27" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb4-28"><a href="design.html#cb4-28" tabindex="-1"></a>}</span>
<span id="cb4-29"><a href="design.html#cb4-29" tabindex="-1"></a></span>
<span id="cb4-30"><a href="design.html#cb4-30" tabindex="-1"></a><span class="kw">const</span> expanse1 <span class="op">=</span> <span class="fu">expanseContinuous</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb4-31"><a href="design.html#cb4-31" tabindex="-1"></a></span>
<span id="cb4-32"><a href="design.html#cb4-32" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(expanse1<span class="op">.</span><span class="fu">normalize</span>(<span class="dv">5</span>))<span class="op">;</span></span>
<span id="cb4-33"><a href="design.html#cb4-33" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(expanse1<span class="op">.</span><span class="fu">unnormalize</span>(<span class="fl">0.5</span>))</span></code></pre></div>
<pre><code>## 0.4444444444444444
## 5.5</code></pre>
<p>The functions <span class="math inline">\(n, u\)</span> have several interesting properties. First off, they are inverses to each other and form an <em>isomorphism</em>, i.e. <span class="math inline">\(u = n^{-1}\)</span> and <span class="math inline">\(n = u^{-1}\)</span> such that <span class="math inline">\(u(n(x)) = x\)</span> and <span class="math inline">\(n(u(p)) = p\)</span>. This also means that each function is a 1-to-1 mapping or <em>bijection</em>. In plain words, this means that we cannot get the same percentage by normalizing two different values and vice versa. As a result, we can keep switching between the normalized and unnormalized representations without losing any information:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="design.html#cb6-1" tabindex="-1"></a><span class="fu">with</span>(expanse, <span class="fu">unnormalize</span>(<span class="fu">normalize</span>(<span class="dv">5</span>)))</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="design.html#cb8-1" tabindex="-1"></a><span class="fu">with</span>(expanse, <span class="fu">normalize</span>(<span class="fu">unnormalize</span>(<span class="fu">normalize</span>(<span class="fu">unnormalize</span>(<span class="fl">0.5</span>)))))</span></code></pre></div>
<pre><code>## [1] 0.5</code></pre>
<div id="linearity" class="section level5 hasAnchor" number="3.0.4.3.1">
<h5><span class="header-section-number">3.0.4.3.1</span> Linearity<a href="design.html#linearity" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Another important thing to note is that, while these types of normalizing functions are often called “linear” (e.g. <code>scaleLinear()</code> in <strong>D3</strong>), since their graphs form a straight line, they should not be confused with “linear functions”, since they do not satisfy the properties of linear functions, namely:</p>
<ul>
<li>Additivity: <span class="math inline">\(\text{normalize}(x + c) \neq \text{normalize}(x) + \text{normalize}(c)\)</span></li>
<li>Homogeneity of degree 1: <span class="math inline">\(\text{normalize}(c \cdot x) \neq c \cdot \text{normalize(x)}\)</span>.</li>
</ul>
<p>To illustrate, additivity does not hold when <span class="math inline">\(\min \neq 0\)</span> because:</p>
<p><span class="math display">\[\frac{(x + c) - \min}{(\max - \min)}\]</span>
<span class="math display">\[= \frac{x - \min}{\max - \min} + \frac{c}{\max - \min}\]</span>
<span class="math display">\[\neq \frac{x - \min}{\max - min} + \frac{c - \min}{\max - \min}\]</span></p>
<p>The same can be easily shown for the <span class="math inline">\(\text{unnormalize}\)</span> map and for homogeneity.</p>
<p>Technically, this is due to a confusion between the definition of a “linear function” and a “linear polynomial”. The appropriate term to use would actually be “affine transformation.”</p>
<p>Either way, if the minimum is not 0, we cannot expect the following to be equal:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="design.html#cb10-1" tabindex="-1"></a><span class="fu">with</span>(expanse, <span class="fu">c</span>(<span class="fu">normalize</span>(<span class="dv">5</span>), <span class="fu">normalize</span>(<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">normalize</span>(<span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] 1.0000000 0.9273474</code></pre>
<p>Or the following to be equal:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="design.html#cb12-1" tabindex="-1"></a><span class="fu">with</span>(expanse, <span class="fu">c</span>(<span class="fu">normalize</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="dv">5</span>), <span class="dv">2</span> <span class="sc">*</span> <span class="fu">normalize</span>(<span class="dv">5</span>)))</span></code></pre></div>
<pre><code>## [1] 1.749319 2.000000</code></pre>
<p>However, if we keep in mind the fact that the normalizing function calculates the proportion of distance from the origin, we can see that the function in fact behaves linearly within the context of its limits.</p>
<p>For example, consider the range <span class="math inline">\([1, 10]\)</span>. The value <span class="math inline">\(5\)</span> is <span class="math inline">\(4\)</span> units away from the lower limit, i.e. <span class="math inline">\(5 - 1 = 4\)</span>, so we can represent it, for example, as the sum of a value that is 3 units away and another that is one unit away, <span class="math inline">\(n(5) = n(4) + n(2)\)</span>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="design.html#cb14-1" tabindex="-1"></a><span class="fu">with</span>(expanse, <span class="fu">c</span>(<span class="fu">normalize</span>(<span class="dv">5</span>), <span class="fu">normalize</span>(<span class="dv">4</span>) <span class="sc">+</span> <span class="fu">normalize</span>(<span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] 1.000000 1.144123</code></pre>
<p>Likewise, again because <span class="math inline">\(5\)</span> represents the distance of <span class="math inline">\(4\)</span> units and <span class="math inline">\(3\)</span> of <span class="math inline">\(2\)</span>, we can expect <span class="math inline">\(n(5) = 2 \cdot n(3)\)</span>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="design.html#cb16-1" tabindex="-1"></a><span class="fu">with</span>(expanse, <span class="fu">c</span>(<span class="fu">normalize</span>(<span class="dv">5</span>), <span class="dv">2</span> <span class="sc">*</span> <span class="fu">normalize</span>(<span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## [1] 1.000000 1.184483</code></pre>
</div>
<div id="transformations" class="section level5 hasAnchor" number="3.0.4.3.2">
<h5><span class="header-section-number">3.0.4.3.2</span> Transformations<a href="design.html#transformations" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>We can apply transformations to continuous expanses by transforming their limits. The outcome of this is that <span class="math inline">\(\min\)</span> and <span class="math inline">\(\max\)</span> still get mapped to <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> however, the graph of the function is no longer linear. Suppose we have non-linear function <span class="math inline">\(f\)</span>, along with an inverse <span class="math inline">\(f^{-1}\)</span>. Then:</p>
<p><span class="math display">\[n(x) = \frac{f(x) - f(\min)}{f(\max) - f(\min)}\]</span>
<span class="math display">\[u(p) = f^{-1} \bigg\{f(\min) + p \cdot \big[ f(\max) - f(\min) \big] \bigg\}\]</span>
For example, here’s how we could apply the transformation <span class="math inline">\(\bigg( f(x) = \sqrt{x}, \; f^{-1}(x) = x^2 \bigg)\)</span> in code:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="design.html#cb18-1" tabindex="-1"></a>expanse<span class="sc">$</span>trans <span class="ot">&lt;-</span> sqrt</span>
<span id="cb18-2"><a href="design.html#cb18-2" tabindex="-1"></a>expanse<span class="sc">$</span>inv <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb18-3"><a href="design.html#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="design.html#cb18-4" tabindex="-1"></a><span class="co"># Need to redefine normalize and unnormalize</span></span>
<span id="cb18-5"><a href="design.html#cb18-5" tabindex="-1"></a>expanse<span class="sc">$</span>trans_range <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="fu">with</span>(expanse, <span class="fu">trans</span>(max) <span class="sc">-</span> <span class="fu">trans</span>(min))</span>
<span id="cb18-6"><a href="design.html#cb18-6" tabindex="-1"></a>expanse<span class="sc">$</span>normalize <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb18-7"><a href="design.html#cb18-7" tabindex="-1"></a>  <span class="fu">with</span>(expanse, (<span class="fu">trans</span>(x) <span class="sc">-</span> <span class="fu">trans</span>(min)) <span class="sc">/</span> <span class="fu">trans_range</span>())</span>
<span id="cb18-8"><a href="design.html#cb18-8" tabindex="-1"></a>}</span>
<span id="cb18-9"><a href="design.html#cb18-9" tabindex="-1"></a>expanse<span class="sc">$</span>unnormalize <span class="ot">&lt;-</span> <span class="cf">function</span>(p) {</span>
<span id="cb18-10"><a href="design.html#cb18-10" tabindex="-1"></a>  <span class="fu">with</span>(expanse, <span class="fu">inv</span>(<span class="fu">trans</span>(min) <span class="sc">+</span> p <span class="sc">*</span> <span class="fu">trans_range</span>()))</span>
<span id="cb18-11"><a href="design.html#cb18-11" tabindex="-1"></a>}</span>
<span id="cb18-12"><a href="design.html#cb18-12" tabindex="-1"></a></span>
<span id="cb18-13"><a href="design.html#cb18-13" tabindex="-1"></a><span class="co"># Normalizing limits still returns c(0, 1)</span></span>
<span id="cb18-14"><a href="design.html#cb18-14" tabindex="-1"></a><span class="fu">c</span>(expanse<span class="sc">$</span><span class="fu">normalize</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)))</span></code></pre></div>
<pre><code>## [1] 0.000000 1.749319</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="design.html#cb20-1" tabindex="-1"></a><span class="co"># Notice that these return different values from before though</span></span>
<span id="cb20-2"><a href="design.html#cb20-2" tabindex="-1"></a>expanse<span class="sc">$</span><span class="fu">normalize</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="design.html#cb22-1" tabindex="-1"></a>expanse<span class="sc">$</span><span class="fu">unnormalize</span>(<span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 2.618034</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="design.html#cb24-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb24-2"><a href="design.html#cb24-2" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb24-3"><a href="design.html#cb24-3" tabindex="-1"></a></span>
<span id="cb24-4"><a href="design.html#cb24-4" tabindex="-1"></a><span class="co"># The graphs are no longer linear</span></span>
<span id="cb24-5"><a href="design.html#cb24-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb24-6"><a href="design.html#cb24-6" tabindex="-1"></a><span class="fu">plot</span>(x, expanse<span class="sc">$</span><span class="fu">normalize</span>(x), <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;normalize(x)&quot;</span>)</span>
<span id="cb24-7"><a href="design.html#cb24-7" tabindex="-1"></a><span class="fu">plot</span>(p, expanse<span class="sc">$</span><span class="fu">unnormalize</span>(p), <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;unnormalize(p)&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Transformations such as these can be useful in two ways. First, sometimes we may be able to better see trends in the data when the data has been appropriately transformed. This is the case, for example, when plotting data which varies across orders of magnitude. In this case it may be useful to apply <span class="math inline">\(\log\)</span>-transformation. Second, transformations can also be helpful in situations where some graphical attributes are not perceived linearly. For example, when judging differently sized objects, viewers tend judge magnitude based on area rather than side or radius. As such, when drawing objects such as points or squares it can be helpful to apply square root as the inverse transformation. The idea is that, if one point has a data value that is <span class="math inline">\(c\)</span> times bigger than another, it will have <span class="math inline">\(\sqrt{c}\)</span> times bigger radius and <span class="math inline">\(c\)</span> times bigger area. Note that we are talking about the inverse transformation here, i.e. the transformation affecting the unnormalizing function.</p>
<p>One thing to note is that the proportionality of the square-root transformation holds only when <span class="math inline">\(\min = 0\)</span>. Otherwise:</p>
<p><span class="math display">\[\sqrt{(\min)^2 + cp \cdot [(\max)^2 - (\min)^2]}\]</span>
<span class="math display">\[= \sqrt{c} \cdot \sqrt{(\min)^2/c + p \cdot [(\max)^2 - (\min)^2]}\]</span>
<span class="math display">\[\neq \sqrt{c} \cdot \sqrt{(\min)^2 + p \cdot [(\max)^2 - (\min)^2]}\]</span></p>
<p>This is a problem in the existing packages. For example:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="design.html#cb25-1" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb25-2"><a href="design.html#cb25-2" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">area_pal</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>))  </span>
<span id="cb25-3"><a href="design.html#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="design.html#cb25-4" tabindex="-1"></a><span class="co"># Comparing cscale to naive implementation</span></span>
<span id="cb25-5"><a href="design.html#cb25-5" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">cscale</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, pal), <span class="fu">sqrt</span>((<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">4</span>) <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="design.html#cb27-1" tabindex="-1"></a><span class="co"># Should be equal since 3 is twice as far from 1 as 2 is</span></span>
<span id="cb27-2"><a href="design.html#cb27-2" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">cscale</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, pal)[<span class="dv">3</span>] <span class="sc">/</span> <span class="fu">cscale</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, pal)[<span class="dv">2</span>], </span>
<span id="cb27-3"><a href="design.html#cb27-3" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 1.276142 1.414214</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="design.html#cb29-1" tabindex="-1"></a>expanse<span class="sc">$</span>min <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb29-2"><a href="design.html#cb29-2" tabindex="-1"></a>expanse<span class="sc">$</span>max <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb29-3"><a href="design.html#cb29-3" tabindex="-1"></a><span class="fu">cscale</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, pal)</span></code></pre></div>
<pre><code>## [1] 1.000000 3.000000 3.828427 4.464102 5.000000</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="design.html#cb31-1" tabindex="-1"></a>expanse<span class="sc">$</span><span class="fu">unnormalize</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 1.555542 2.233313 3.033313 3.955542 5.000000</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="design.html#cb33-1" tabindex="-1"></a>expanse</span></code></pre></div>
<pre><code>## $min
## [1] 1
## 
## $max
## [1] 5
## 
## $trans
## function (x)  .Primitive(&quot;sqrt&quot;)
## 
## $inv
## function(x) x^2
## &lt;bytecode: 0x55913bc87e38&gt;
## 
## $range
## function() self$max - self$min
## &lt;bytecode: 0x559141b3de20&gt;
## &lt;environment: 0x559141478f50&gt;
## 
## $trans_range
## function() with(expanse, trans(max) - trans(min))
## &lt;bytecode: 0x55913cc149f8&gt;
## 
## $normalize
## function(x) {
##   with(expanse, (trans(x) - trans(min)) / trans_range())
## }
## &lt;bytecode: 0x55913cd8f490&gt;
## 
## $unnormalize
## function(p) {
##   with(expanse, inv(trans(min) + p * trans_range()))
## }
## &lt;bytecode: 0x55913b32bb08&gt;</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="design.html#cb35-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, expanse<span class="sc">$</span><span class="fu">unnormalize</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="design.html#cb36-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">cscale</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, pal))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-12-2.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
</div>
<h3> References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bostock2011" class="csl-entry">
Bostock, Michael, Vadim Ogievetsky, and Jeffrey Heer. 2011. <span>“D<span class="math inline">\(^3\)</span> Data-Driven Documents.”</span> <em>IEEE Transactions on Visualization and Computer Graphics</em> 17 (12): 2301–9.
</div>
<div id="ref-gray1997" class="csl-entry">
Gray, Jim, Surajit Chaudhuri, Adam Bosworth, Andrew Layman, Don Reichart, Murali Venkatrao, Frank Pellow, and Hamid Pirahesh. 1997. <span>“Data Cube: A Relational Aggregation Operator Generalizing Group-by, Cross-Tab, and Sub-Totals.”</span> <em>Data Mining and Knowledge Discovery</em> 1: 29–53.
</div>
<div id="ref-wickham2013" class="csl-entry">
Wickham, Hadley. 2013. <span>“Bin-Summarise-Smooth: A Framework for Visualising Large Data.”</span> <em>Had. Co. Nz, Tech. Rep</em>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>The one exception may be panning barplots and histograms, where the y-axis upper y-axis limit may change but the lower should be fixed at 0, such that panning may shrink or stretch the bars, but not “lift” them up or move them down.<a href="design.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
