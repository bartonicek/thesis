---
title: "The Fabric of Interactive Visualization"
subtitle: "From the Algebra of Graphics, Statistics, and Interaction to Practical Implementation"
author: "Adam Bartonicek"
site: bookdown::bookdown_site
documentclass: book
always_allow_html: true
output:
  bookdown::gitbook:
    css: styles.css
  bookdown::pdf_document2:
    latex_engine: xelatex
  bookdown::pdf_book:
    latex_engine: xelatex
bibliography: [references.bib]
biblio-style: "apalike"
link-citations: true
editor_options: 
  chunk_output_type: console
header-includes:
  - \usepackage{tikz-cd}
---

# Abstract

Placeholder



<!--chapter:end:index.Rmd-->

# Introduction {#introduction}

> It’s written here: "In the Beginning was the Word!" <br>
> Here I stick already! Who can help me? It’s absurd, <br>
> [...] <br>
> The Spirit helps me! I have it now, intact. <br>
> And firmly write: "In the Beginning was the Act!"
>
> Faust, Part I, Johann Wolfgang von Goethe [-@goethe2015]

Humans are intensely visual creatures. About 20-30% of our brain is involved in visual processing [@van2003; @sheth2016], providing support for a highly sophisticated and powerful visual system [see e.g. @goebel2004; @knudsen2020; for a brief review, see @ware2019], which in turn enables us to perform some remarkable perceptual feats. For instance, it is well-established that our brain can process certain highly salient visual stimuli in sub-20-millisecond times, outside of conscious attention [@ledoux2000; @ledoux2003], and that we can make extremely rapid, accurate, and parallel visual judgements, through phenomena known as subitizing and pre-attentive processing [@mandler1982; @treisman1985]. Features such as these establish the visual system as the most potent information channel at our disposal.

Crucially, while the visual cortex excels at processing data about the natural world, it is equally adept at processing abstract information. Statisticians have long capitalized on this fact. Emerging from early charts and maps, data visualization has co-evolved alongside mathematical statistics, providing a complementary set of tools and methods [for a review, see @friendly2006 or Section \@ref(brief-history)]. Specifically, while mathematical statistics was primarily developed with the goal of supporting or disproving scientific hypotheses, data visualization offered an alternative approach: unsupervised exploration. Rather than providing answers to binary decisions, it demonstrated its worth in "forcing us to notice that which we would never expect to see" [@tukey1977]. This invaluable role in revealing the unexpected eventually established data visualization as an indispensable part of the applied statistician's arsenal.

Our interaction with the natural world extends beyond sight, however. When we try to understand unknown objects, we do not just look; we also touch, manipulate, and probe. Consequently, within our brain, action and perception are not independent, but instead deeply interconnected, mutually reinforcing processes [see e.g. @dijkerman2007; @lederman2009]. As a consequence, the most effective learning strategies tend to involve "learning by doing"; passive observation is less effective [@hackathorn2011; @reese2011]. As the saying goes, seeing is believing, but how much is that belief really worth if you can't put your finger on it?

Naturally, statisticians would eventually come to exploit this connection between action and perception as well, just as they had done with visual perception alone. In the latter half of the twentieth century, the development of computer graphics, and interactive data visualization in particular, transformed the idea of "interrogating a chart" from a mere turn of phrase into tangible reality. Suddenly, users could directly manipulate the visual representation of the data in real time, uncovering new insights with a keystroke or a mouse click.

The power of interactive data visualization quickly established it as one of the most popular ways of presenting data. Today, interactive graphics make frequent appearance in online news articles, on government websites, and in commercial dashboards. Similarly, data science developer ecosystems are flush with software for creating interactive graphics. Thus, given its ubiquity, it may seem as though interactive data visualization is a "solved problem".

Yet, a number of issues surrounding the use and understanding of interactive visualizations remain. While interactive visualizations are indeed popular in large organizations, individual analysts rarely integrate them into their workflows [see e.g. @batch2017]. Further, despite years of research and development, only a small fraction of sophisticated interactive features have made it into the widely available software (see Section \@ref(background)). Finally, a core underlying issue that is yet to be resolved is that of data pipelines: how do we go about modeling the process of transforming raw data into something that can be interactively visualized, in a simple and efficient manner [see e.g. @wickham2009; @vanderplas2020]?

In this thesis, I explore the challenges that come up when developing interactive data visualization systems. A recurring theme will be that, although plots are visual entities composed of geometric objects, they are not mere pictures. Instead, they contain a significant amount of implicit, algebraic structure. This underlying structure dictates how plots can be manipulated, a fact that becomes particularly evident when interaction is introduced. 

By focusing on this underlying algebraic foundation, I build upon the work of Leland Wilkinson, and the Grammar of Graphics (GoG) model in particular [-@wilkinson2012]. However, I contend that while GoG offers a foundational framework, it may require certain refinements to fully encompass the scope of interactive graphics. To illustrate the point bluntly, consider the following two quotes:

> "This system cannot produce a meaningless graphic, however. This is a strong claim, vulnerable to a single counter-example. It is a claim based on the formal rules of the system, however, not on the evaluation of specific graphics it may produce."
>
> "Some of the combinations of graphs and statistical methods may be degenerate or bizarre, but there is no moral reason to restrict them."
>
> @wilkinson2012, pp. 15 and 112

What makes some combinations of graphics and statistics meaningful, while others degenerate or bizarre? I believe that answering this question is essential for building coherent data visualization systems, particularly ones involving interaction. Statistics may be a somewhat overlooked component of the GoG model^[See also the following quote: "I have tried to build the argument, except for the statistical methods in Chapter 7, from elementary definitions.", pp. 10 of the first-edition preface.]. Yet, I contend that, when developing interactive data visualizations, grappling with the properties of statistics underlying our plots is absolutely essential.

To expand on this idea, the main thrust of my argument is that what we can *do* with a graphic is fundamentally determined what the graphics *is*. Like geometric objects and scales, summary statistics are essential components of plots, and, when considered all in context, different patterns emerge. Some types of plots exhibit a special kind of congruence between data, summary statistics, and visuals, which ensures predictable behavior under interaction. Other types of plots break this congruence, making certain interactive features brittle or difficult to implement. Exploring this congruence is one of the primary tasks of the present thesis. To describe it formally, I propose a simple model leveraging some fundamental algebraic concepts from category theory [see e.g. @fong2019]. These concepts, and my application of them, extends beyond GoG [@wilkinson2012]. Specifically, while GoG treats data, statistics, and graphics as entirely independent, modular components, I instead propose a compositional model which focuses on preserving key mathematical properties.

Finally, since interactive data visualization is a very much an applied discipline, all this theory would be pointless if it did not lead to practical, actionable insights. Therefore, to validate and refine these theoretical findings, I also develop an original open-source interactive data visualization library, `plotscaper` (https://github.com/bartonicek/plotscaper). Consequently, parts of this thesis are dedicated to the design and architecture of this system, as well as its application to real-world data. Throughout these sections, I repeatedly explore and elaborate on the connections between the mathematical theory and its practical application. 

Ultimately, I contend that, to build truly general and efficient interactive data visualization systems, we need to take the algebraic relationships underlying plots into account. Only by precisely describing what a plot *is* can we begin to reason about what we can *do* with it.

#### Structure of the thesis

The thesis is organized as follows:

- **Section \@ref(background)** provides a brief overview of the history of interactive data visualization, theoretical considerations regarding interactive graphics as well as common interactive features, and several broader, important topics in data visualization. 
- **Section \@ref(problems)** identifies key challenges in designing interactive data visualization pipelines and introduces some core algebraic theory. 
- **Section \@ref(goals)** outlines the general objectives and goals that guided the development of the interactive data visualization software system (`plotscaper`).
- **Section \@ref(system)** overviews key design and architectural decisions, and discusses key components of the delivered software. 
- **Section \@ref(applied-example)** presents a practical example of applying `plotscaper` to explore a real-world data set. 
- **Section \@ref(discussion)** discusses lessons learned and potential future research directions, covering both the theoretical model and the applied work.
- **Section \@ref(conclusion)** provides some concluding remarks and closing thoughts.

<!--chapter:end:introduction.Rmd-->


# Background {#background}

Placeholder


## Brief history of interactive data visualization {#brief-history}
### Static data visualization: From ancient times to the space age {#static-visualization}
### Early interactive data visualization: By statisticians for statisticians {#early-interactive}
#### Open-source Statistical Computing
#### Common features and limitations of early interactive systems
### Interactive data visualization and the internet: Web-based interactivity {#web-based}
#### D3
#### Plotly and Highcharts
#### Vega and Vega-Lite
#### Common features and limitations of web-based interactive systems
## What even is interactive data visualization? {#what-is-interactive-visualization}
### Interactive vs. interacting with {#interactive-interacting}
### Interactive *enough*? {#interactive-enough}
### Complexity of interactive features {#complexity-of-features}
### Working definition
### Common interactive features {#common-features}
#### Changing size and opacity
#### Zooming and panning
#### Querying
#### Sorting and reordering
#### Parametric interaction
#### Animation and projection
#### Representation switching {#representation-switching}
#### Linked selection {#linked-selection}
## Overview of broader data visualization topics
### Visualization goals {#visualization-goals}
### Visual perception {#visual-perception}
### Scales and measurement {#scales-measurement}
### Graphics formats {#graphics-formats}
#### Raster graphics
#### Vector graphics
## Summary

<!--chapter:end:litreview.Rmd-->


# Challenges {#problems}

Placeholder


## The structure of this chapter: Data visualization pipeline
## Partitioning {#partitioning}
### Showing the full data {#show-all-data}
### Comparison and disjointness {#comparison-disjointness}
#### Naturality of disjointness
#### Disjointness and bijections
#### Disjointness in visualizations: Real-world example
#### Disjointness and interaction {#disjointness-interaction}
### Plots as partitions
#### Bijection on cases vs. bijection on subsets
#### Products of partitions {#products-of-partitions}
#### Limits of flat product partitions {#limits-of-flat-products}
### Partitions, hierarchy, and preorders {#hierarchy}
#### Plots as preorders {#plots-as-preorders}
#### The graph behind the graph
## Aggregation
### The relationship between graphics and statistics
#### Independence: The grammar-based model
#### Motivating example: Limits of independence {#stacking-not-graphical}
#### Some statistics are stackable but others are not {#stackable-or-not}
#### Advantages of stacking: Part-whole relations {#stacking-part-whole}
### Stackable summaries: A brief journey into Category Theory {#aggregation-category-theory}
#### Past applications of category theory to data visualization {#visualization-category-theory}
#### Generalizing preorders: Categories {#preorders-categories}
#### Structure preserving maps: Functors {#structure-functors}
#### Aggregation: A functor from data subsets to summary statistics {#aggregation-functor}
#### Functorial summaries and set union
#### Whole equal to the sum of its parts: Monoids {#monoids}
#### Programming with monoids {#programming-with-monoids}
#### Groups and inverses {#groups-inverses}
#### Other properties: Monotonicity and commutativity {#monotonicity-commutativity}
##### Monotonicity
##### Commutativity
#### Transforming summaries: Stacking, normalizing, and shifting {#transforming-summaries}
##### Stacking
##### Normalizing
##### Shifting {#shifting}
## Scaling and encoding {#scaling}
#### Scales as functions {#scales-as-functions}
#### Limits of modeling scales with simple functions {#simple-scale-limits}
#### Solution: Scales as function composition {#scales-composition}
##### Reusability and discrete scales
##### The intermediate interval {#scaling-intermediate}
##### Implementing scale features via the intermediate interval
###### Margins
###### Panning
###### Zooming
##### Inverses {#scaling-inverses}
##### Scale transformations
#### Comparison to past implementations of scales {#scales-comparison}
## Rendering
### Frames {#frames}
### Geoms
#### Rendering geoms: A functor from summary statistics to graphics {#rendering-functor}
### Auxiliary graphical elements {#auxiliary-elements}
## Summary

<!--chapter:end:problems.Rmd-->


# Goals {#goals}

Placeholder


## User profile
## Programming interface
## User interface
## Interactive features
## Summary

<!--chapter:end:goals.Rmd-->


# System description {#system}

Placeholder


## Core requirements
## High-level API (`plotscaper`) {#high-level-api}
### API design {#api-design}
### Basic example {#basic-example}
#### Figure vs. plot and selectors {#figure-plot}
#### Variable names
#### Variables and encodings {#variables-encodings}
### The scene and the schema {#scene-and-schema}
### Client-server communication {#client-server}
### HTML embedding
## Overview of the system model
### The interactive data visualization pipeline {#model-pipeline}
### Scene model
### Plot model
### Hierarchical data summaries: computation, transformation, and encoding
#### Problems with naive joins
#### Solution: Computing summaries in one go
#### Encoding summaries
## Low-level implementation (`plotscape`) {#low-level-implementation}
### Programming paradigm {#programming-paradigm}
#### Procedural programming
#### Functional programming {#functional}
#### Object-oriented programming {#oop}
#### Data-oriented programming {#dop}
#### Final choice of programming paradigm and rationale
#### Style used in code examples
### Data representation: Row-oriented vs. column-oriented {#row-column}
#### Ease of use
#### Performance {#row-column-performance}
#### Final choice of data representation and rationale
### Reactivity {#reactivity}
#### Observer pattern {#observer}
#### Streams {#streams}
#### Virtual DOM
#### Signals {#signals}
#### Reactivity in `plotscape` and final thoughts {#reactivity-solution}
### System components {#components}
#### Indexable {#indexable}
#### Getter {#getter}
#### Dataframe {#dataframe}
#### Factors
##### Bijection and constant factors
##### Discrete factors
##### Binned factors
##### Product factors {#product-factors}
#### Marker
##### Transient vs. persistent selection {#transient-persistent}
##### Group assignment indices {#group-indices}
##### Updating group assignment indices
#### Aggregation: Reducers, reduceds, and summaries {#aggregation-summaries}
##### Reducers {#reducers}
##### Reduced
##### Summaries {#summaries}
#### Scales {#scales}
##### Scale properties
#### Expanses {#expanses}
#### Continuous expanses
#### Point expanses
#### Band expanses
##### Compound and split expanses
#### Plot {#plot}
##### Data {#plot-data}
##### Scales {#plot-scales}
##### Rendering {#plot-rendering}
#### Events and interactive features
##### Activation and deactivation
##### Growing/shrinking objects
##### Mouse-move interaction: selection, panning, and zooming {#plot-mousemove}
####### Selection
####### Panning
####### Querying
#### Zooming
#### Scene {#scene}
##### Plots
##### Marker
##### WebSockets client
##### Events and Keybindings

<!--chapter:end:system.Rmd-->


# Applied example {#applied-example}

Placeholder


### About the data set
### Interactive exploration
#### The relationship between cases and days
#### Number of cases over time
#### Age and child and adolescent mental health
#### Prevalence of diagnoses
#### Prevalence of diagnoses over time
#### Characteristics of patient cohorts over time
## Summary

<!--chapter:end:example.Rmd-->


# Discussion

Placeholder


## Theoretical model
### Why the model is necessary
### Disjointness
### Associativity and unitality {#associativity-unitality}
### Groups and inverses {#discussion-groups-inverses}
### Additional properties: Monotonicity, commutativity, and others
### Model constraints
### Potential future directions
## Delivered software (`plotscaper`)
### Scope and features
### Declarative schemas and extensibility {#declarative-schemas}
### Performance {#performance}

<!--chapter:end:discussion.Rmd-->

# Conclusion

This thesis explored algebraic relationships underlying interactive data visualization pipelines. Specifically, it investigated the intricate interplay between data, summary statistics, graphics, and interaction. A recurring central theme has been that what we compute (statistics), how we represent it (graphics), and what we do with it (interaction) are not independent concerns. Instead, for graphics to behave well, particularly under interaction, their components need to exhibit a particular kind of congruence, which can be described via the language of category theory. 

This perspective challenges the presently dominant approach in data visualization. In many popular data visualization packages, graphics and statistics (and interaction) are treated as independent, modular components. However, I believe I have been able to demonstrate that this independence model is insufficient for reasoning about visualizations comprehensively, and can lead to meaningless, "bizarre or degenerate" graphics. By contrast, the model I propose allows us to identify those combinations of graphics and statistics which will be meaningful, by virtue of composition, and those which will be degenerate or bizzare, due to lack thereof. Further, it also allows us to reason about when certain types of interactions, particularly linked selection, will combine with the graphic to produce certain predictable, natural results.

Further, I also tested and refined many of the ideas surrounding the model by developing an original interactive data visualization library for R: `plotscaper`. Beyond theory testing, `plotscaper` was developed to provide a practical tool for data exploration, a goal which appears to have been achieved with moderate success, as evidence by the package's download statistics in the relatively short time interval since its initial release. Developed largely from scratch and with minimal dependencies, the creation of the `plotscaper` necessitated the resolution of numerous fundamental programming issues and architectural concerns. Many of these challenges and their solutions are also documented throughout this thesis, with the goal of providing directions for potential future research and development.

In conclusion, I find the algebraic structure of data visualizations and its relationship to interactivity to be a fascinating topic. I consider myself lucky to have stumbled upon a few intriguing ideas that allowed me to see graphics in an entirely new light. Yet, I recognize that the model presented in this thesis is far from exhaustive, and significant opportunities remain for future research. Since the model is built on some simple, foundational concepts from category theory, it is natural to assume that category theory may yield many further, much deeper insights regarding the nature of the relationships between graphics, statistics, and interaction. Nevertheless, I hope it is clear that even these simple ideas provide a powerful tool for reasoning about graphics and even possess a significant applied utility. Ultimately, developing truly generic and robust interactive data visualization systems may require grappling with these ideas further.

<!--chapter:end:conclusion.Rmd-->


# Appendix: Glossary

Placeholder


#### API {#API}
#### JSON {#JSON}
#### GoG
#### IDE
#### SVG

<!--chapter:end:glossary.Rmd-->


# Appendix: Mathematical theory {#math}

Placeholder


#### Relations {#relations}
#### Functions {#functions}
##### More on bijections {#bijections}
##### Composition
##### The image and the pre-image
#### Partitions {#partitions}
#### Preorders {#preorders}
##### Specializing preorders
##### Structure preserving maps: Monotone maps
#### Monoids
#### Simple examples of monoids
##### Beyond numbers
#### Specializing monoids
##### Structure preserving maps: Monoid homomorphisms {#monoid-homomorphism}
#### Groups
##### Simple examples of groups
##### Structure preserving maps: Group homomorphisms {#group-homomorphism}
#### Categories {#categories}
##### Isomorphisms within categories {#isomorphism}
##### Algebraic structures described as categories {#algebraic-as-categories}
#### Functors {#functors}

<!--chapter:end:math.Rmd-->

# References


<!--chapter:end:references.Rmd-->

