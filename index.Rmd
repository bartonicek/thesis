---
title: "Fluent Graphics"
author: "Adam Bartonicek"
site: bookdown::bookdown_site
documentclass: book
output:
  # bookdown::gitbook: default
  bookdown::pdf_book: default
bibliography: [references.bib]
link-citations: true
---


# Abstract 

Something something about section.

```{r}
#| echo: false

knitr::opts_chunk$set(
  cache = TRUE,
  fig.align = 'center'
)

get_ts_filepath <- function(x) {
  if (endsWith(x, ".ts")) {
    paste0("/tmp/Rtmp2p1Ve6/", trimws(gsub("//", "", x)))
  } else {
    tempfile(fileext = ".ts")
  }
}

knitr::knit_engines$set(ts = function(options) {
  code <- paste0(options$code, collapse = "\n")
  
  ts_path <- get_ts_filepath(options$code[1])
  ts_conn <- file(ts_path)
  writeLines(code, ts_conn)
  
  args <- c(shQuote(code), "| /home/adam/.bun/bin/bun run", ts_path)
  out <- system2("echo", args, stdout = TRUE)
  
  close(ts_conn)
  
  knitr::engine_output(options, code, out)
})

```

